<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
    <link rel="stylesheet" href="./assets/Styles/dash.css" />
  </head>
  <body onload="exibirAquarios()">
    <div class="kpiData">Última Atualização: <span id="dataHora"></span></div>

    <div class="main">
      <div class="sidebar">
        <div class="profile">
          <img src="./assets/Imgs/account.png" alt="Perfil" />

          <h1>Olá, Brandão!</h1>
        </div>

        <a href="./dashboard.html">Visão Geral</a>
        <a href="./detalhes.html">Histórico de Alertas</a>
        <a href="./cadastro-dryflow.html">Cadastrar Novo Usúario</a>

        <a href="./dryflow-index.html" class="logout-btn">
          Sign-out
          <img
            src="./assets/Imgs/logout.png"
            alt="Logout"
            class="logout-icon"
          />
        </a>
      </div>
      <div class="container">
        <div class="graficos">
          <!-- <span class="legenda">Parâmetros para Alertas</span> -->
          <div class="info-limites">
            <div class="card">
              <div class="primeira">Entre 45% e 49%</div>
              <!-- <h4 >Próximo ao Limite de Umidade</h4>
                <span >Entre 45% e 49%</span> -->
              <p>
                Compressores perto do limite de umidade:<br /><br /><span
                  id="kpi-perto"
                  >0</span
                >
              </p>
            </div>
            <div class="card">
              <div class="segunda">Em 50%</div>
              <!-- <h4 >Limite de Umidade</h4>
                <span>50%</span> -->
              <p>
                Compressores no limite de umidade:<br /><br /><span
                  id="kpi-no-limite"
                  >0</span
                >
              </p>
            </div>
            <div class="card">
              <div class="terceira">Maior que 50%</div>
              <!-- <h4 >Acima do Limite de Umidade</h4>
                <span>Maior que 50%</span> -->
              <p>
                Compressores acima do limite de umidade:<br /><br /><span
                  id="kpi-acima"
                  >0</span
                >
              </p>
            </div>
          </div>
          <!-- KPIs -->
          <!-- <div class="kpis-container">
              <div class="card1">
                <p>
                  Compressores perto do limite de umidade:<br /><br /><span id="kpi-perto">0</span>
                </p>
              </div>
              <div class="card2">
                <p>
                  Compressores dentro do limite de umidade:<br /><br /><span id="kpi-no-limite">0</span>
                </p>
              </div>
              <div class="card3">
                <p>
                  Compressores acima do limite de umidade:<br /><br /><span id="kpi-acima">0</span>
                </p>
              </div>
            </div>-->
        </div>

        <div class="filtro">
          <div style="width: 70%; text-align: center">
            <h3>Compressores da Oficina Brandão Car's</h3>
          </div>
          <div style="display: flex; flex-direction: column; margin-top: 0%">
            <p>Filtrar Compressores:</p>
            <select name="fitro_compressor" id="fitro_compressor">
              <option value="todos">Todos</option>
              <option value="riscoAlto">Nível de Risco Alto</option>
              <option value="riscoMedio">Nível de Risco Médio</option>
              <option value="riscoBaixo">Nível de Risco Baixo</option>
            </select>
          </div>
        </div>
        <p style="color: #343030ae; font-size: 12px; margin-bottom: 14px">
          Clique em um compressor para ver mais informações.
        </p>

        <div class="cards" id="cardAquarios"></div>

        <div class="cardsInfo">
          <div class="card">
            <h4>Compressor A</h4>
            <p>ID Compressor: 1</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 80%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor B</h4>
            <p>ID Compressor: 2</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 84%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor C</h4>
            <p>ID Compressor: 3</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 47%</p>
            <p>Nível de Risco: <span class="medio">Médio</span></p>
          </div>
          <div class="card">
            <h4>Compressor D</h4>
            <p>ID Compressor: 4</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 43%</p>
            <p>Nível de Risco: <span class="baixo">Baixo</span></p>
          </div>
        </div>

        <!-- <div class="cardsInfo">
          <div class="card">
            <h4>Compressor E</h4>
            <p>ID Compressor: 1</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 80%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor F</h4>
            <p>ID Compressor: 2</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 84%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor G</h4>
            <p>ID Compressor: 3</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 47%</p>
            <p>Nível de Risco: <span class="medio">Médio</span></p>
          </div>
          <div class="card">
            <h4>Compressor H</h4>
            <p>ID Compressor: 4</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 43%</p>
            <p>Nível de Risco: <span class="baixo">Baixo</span></p>
          </div>
        </div>
        <div class="cardsInfo">
          <div class="card">
            <h4>Compressor I</h4>
            <p>ID Compressor: 1</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 80%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor J</h4>
            <p>ID Compressor: 2</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 84%</p>
            <p>Nível de Risco: <span class="alto">Alto</span></p>
          </div>
          <div class="card">
            <h4>Compressor K</h4>
            <p>ID Compressor: 3</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 47%</p>
            <p>Nível de Risco: <span class="medio">Médio</span></p>
          </div>
          <div class="card">
            <h4>Compressor L</h4>
            <p>ID Compressor: 4</p>
            <p>Oficina: Brandão Car's</p>
            <p>Umidade Atual: 43%</p>
            <p>Nível de Risco: <span class="baixo">Baixo</span></p>
          </div>
        </div> -->

        <!-- TABELA DE ALERTAS
             <tr> == linha
              <td> == coluna 
            <table class="table">
                <caption>Alertas</caption>
            
               <tbody> scroll no css  
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                   <td class="text">Compressor A atingiu o limite de umidade! </td>
                  
                   <td> | Umidade: 50%</td>
                 </tr>
                 <tr>
                    <td class="text"> <span  class="alerta">Alerta:</span></td>

                    <td class="text">Compressor B está acima do limite de umidade! Necessário Manutenção! </td>
                  
                    <td> | Umidade: 84%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>
                    <td class="text">Compressor A está próximo ao limite de umidade! Faça uma Manutenção Preventiva.</td>
                  
                    <td> | Umidade: 45%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span  class="alerta">Alerta:</span></td>

                    <td class="text">Compressor C está próximo ao limite de umidade! Faça uma Manutenção Preventiva. </td>
                  
                    <td> | Umidade: 42%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                    <td class="text">Compressor A precisa de Manutenção! </td>
                  
                    <td> | Umidade: 80%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                    <td class="text">Compressor A atingiu o limite de umidade! </td>
                  
                    <td> | Umidade: 52%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                    <td class="text">Atenção! Compressor D está quase atingindo o limite de umidade! </td>
                  
                    <td> | Umidade: 47%</td>
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                    <td class="text">Compressor A atingiu o limite de umidade! </td>
                  
                    <td> | Umidade: 51%</td>
                    
                  
                 </tr>
                 <tr>
                    <td class="text"><span class="alerta">Alerta:</span></td>

                    <td class="text">Compressor A atingiu o limite de umidade! </td>
                  
                    <td> | Umidade: 80%</td>
                  
                 </tr>
             
               </tbody>
             </table> -->
      </div>
    </div>
  </body>
</html>
<script>
  function atualizarDataHora() {
    const agora = new Date();
    const dataHoraFormatada = agora.toLocaleString("pt-BR"); // horario e data brasileiros
    document.getElementById("dataHora").textContent = dataHoraFormatada;
  }

  // Atualiza a hora quanto recarrega a pagina
  atualizarDataHora();
</script>
<script>
  function atualizarKPIs(dados, limite = 50) {
    let perto = 0;
    let noLimite = 0;
    let acima = 0;

    dados.forEach((valor) => {
      if (valor > limite) {
        acima++;
      } else if (valor < limite && valor < limite - 5) {
        noLimite++;
      } else if (valor >= limite - 5 && valor <= limite) {
        perto++;
      }
    });

    document.getElementById("kpi-perto").textContent = perto;
    document.getElementById("kpi-no-limite").textContent = noLimite;
    document.getElementById("kpi-acima").textContent = acima;
  }
</script>

<script>
  // dados sem estar no gráfico
  const dadosUmidade = [80, 84, 47, 43];
  // atualiza as KPIs com base nos dados inseridos manualmente, não os dados do gráfico
  atualizarKPIs(dadosUmidade);
</script>

<script>
  /* SCRIPT do WEBDATAVIZ (cards.html) para gerar os cards de alerta de umidade */
  function exibirAquarios() {
    JSON.parse(sessionStorage.AQUARIOS).forEach((item) => {
      document.getElementById("cardAquarios").innerHTML += `
                  <div class="card-aquario">
                      <div class="title-aquario">
                          <h1>${item.modelo}</h1>
                      </div>
                      <div class="desc-aquario">
                      <div class="temperatura">
                          <p id="temp_aquario_${item.idCompressor}">-°C</p>
                      </div>
                      <div class="cor-alerta" id="card_${item.idCompressor}"></div>
                  </div>
                  </div>
                  `;
    });
  }
</script>
